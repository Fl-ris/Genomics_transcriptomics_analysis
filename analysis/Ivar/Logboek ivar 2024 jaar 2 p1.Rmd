---
title: "Logboek Ivar Jaar 2 P1"
author: "Ivar"
date: "2024-09-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# project introductie
Dit logboek is voor het project genomics en transcriptomics in het thema aging. Hiervoor hebben wij het onderzoek Three-dimensional chromatin reorganization regulates B cell development during ageing gebruikt. Hiervan nemen wij de genomische en transcriptomische onderdelen voor onze onderzoeksvraag "Zijn er genetische varianten te vinden in het embf1 en pax5 gen te vinden dat het vorige onderzoek kan beinvloeden"

# Library chunk
```{r}
library("fastqcr")
library("ggVennDiagram")
library("ggplot2")
library("GenomicRanges")
library("dplyr")
library("tidyr")
```

# Week 1 introductie en data downloaden
# doel project genomics and aging
## Wat en waarom
In de eerste 2 lessen hebben we als groep gezocht naar potentieel onderzoek dat wij kunnen gebruiken voor het project. Het thema dat wij hiervoor hebben gekozen is aging omdat dit ons een interessant lijkt. 
Om een gepast onderzoek te kiezen hebben wij allemaal in de GEO-Datasets van NCBI geken en voor ons interessante onderzoek door te lezen en in onze teams omgeving te posten. daarna hebben wij elkaars alle abstracten van iedereens onderzoek gelezen en een onderzoek uitgekozen om voor te leggen aan marcel.
het onderzoek dat we hebben gekozen na overleg met Marcel is "Three-dimensional chromatin 
reorganization regulates B cell development 
during ageing".
De links hiervoor staan bij resultaten.
hierna hebben wij een taakverdeling gemaakt om het werk eerlijk te verdelen. Mijn taak voor de voorbereiden van de plan van aanpak presentatie is het ontleden en uitleggen van de onderzoeksvraag en het maken van een Gant chart gemaakt.

### Uitleg Onderzoeksvraag
Onderzoeksvraag van het orinele onderzoek
Wat is invloed van chromatine vormverandering op prognater b cellen?
De verwachting is dat doormiddel van veroudering verandering in de TAD (topologically 
associated domains) genen die belangrijk zijn voor de regulatie van B cellen verschuiven van het hoog actieve A compartiment naar het onderdrukte B compartiment verschuiven. Dit kan een belangrijke verklaring kunnen zijn waarom er minder is transcriptie op dit gebied in oudere dieren.

### Notitie's
https://www.youtube.com/watch?v=uakxc0_Dec4 uitleg TAD A/B compartments. de HI-c methode heeft ontdekt dat in het chromatine zich in meer domeinen vormt dan verwacht. op het moment is de er een lopende theorie dat het chromatine zich scheidt in a en b compartementen. 
A compartement
het A compertement is het hoogactieve compartiment waar vaak genen zitten die vaak getranscribeerd worden. hieren in veel interactie tussen promoters en de genen in dit compartiment zonder dat dit een ander compartiment beinvloed.
B compartement.
het B compartement is het laagactieve compartiment. Hierin zitten vaak de onderdrukte genen en/of unieke/"junk" genen.

## Vrijdag 
Vandag hebben wij gezamenlijk de genomics data van ons onderzoek gedownload als SRA files via Floris zijn laptop en onze project map neergezet om volgende week uit te pakken zodat we dit kunnen gebruiken in ons onderzoek.

SRA staat voor Sequence Read Archives het is een ruw data archief voor sequencing bestanden met met een kwaliteits score per sequence zoals fastq bestanden die zwaar gecomprimeerd zijn.  (https://www.ncbi.nlm.nih.gov/sra/docs/submitformats/). 

Hiervoor hebben wij de tool prefetch gebruikt uit de NCBI SRA toolkit[3]. We hebben hier voor gekozen omdat dit geadviseerd werd door Ronald en Marcel met als beredenering dat deze tool de ondersteunde manier is van onder andere NCBI om je data op een efficiënte manier te downloaden en uit te pakken.


```{bash, eval=FALSE}
export PATH="/home/floris/Documenten/Applicaties/sratoolkit.3.1.1-ubuntu64/bin/:$PATH"

cd /run/media/floris/FLORIS_3/DATA_SETS/3D_Chromatine_Conformatie/DNA/SRA/

prefetch $(</run/media/floris/FLORIS_3/DATA_SETS/3D_Chromatine_Conformatie/DNA/SRA/SraAccList.csv) \
--output-directory "/run/media/floris/FLORIS_3/DATA_SETS/3D_Chromatine_Conformatie/DNA/SRA/" --max-size 200G
```

### SraAccList
De SraAccList is een lijst waar de SRA samples van ons onderzoek in staan. Uit de dataset van ons gekozen onderzoek hebben wij alleen de genomics samples hier in gezet.
In dit geval wordt deze lijst gebruikt om uit het SRA archiev onze gekozen samples te downloaden.
Later wordt deze lijst meerdere keren in bash scripts gebruikt voor het automatiseren van bepaalde tools op onze gehele data set.

De SRA files staan in de SRA map "/students/2024-2025/Thema05/3Dchromatine/SRA" in onze project map.


## resultaten
onderzoek links
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11178499/pdf/41556_2024_Article_1424.pdf
https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE214438
Gant chart staat in teams map school.
Uitleg onderzoeksvraag staat hierboven vermeld en in teams map onderzoek.
SRA files in de map "/students/2024-2025/Thema05/3Dchromatine/SRA"


# Week 2 FastQC en Trimmomatic

## Maandag 

# presentatie linkin in logboek
Na de groepenpresentaties hebben wij we gezamenlijk de genomics data uitgepakt met de tool fasterq-dump van de SRA toolkit[1] via floris zijn laptop.

```{bash eval=FALSE}
# Eerst nieuwe map maken voor fastq
# Locale test: (niet op de assemblix server) 
cd /run/media/floris/FLORIS_3/DATA_SETS/3D_Chromatine_Conformatie/DNA/SRA


find /run/media/floris/FLORIS_3/DATA_SETS/3D_Chromatine_Conformatie/DNA/SRA -name "*.sra" | \
  parallel fasterq-dump -O /run/media/floris/FLORIS_3/DATA_SETS/3D_Chromatine_Conformatie/DNA/SRA/FASTQ {}


# parallel gebruiken: cat accessionlist.txt | parallel ls -lah SRA/{}/{}.sra
```

### seqtk test dataset 
Met floris zijn code een fastq data set gemaakt met 1,000,000 lines. Dit hebben we gedaan met de tool Seqtk[4]. 
Deze tool hebben we gekozen omdat het een makkelijke manier is om een subset van data te genereren. Dit heeft als doel al onze data proccesing tools te testen op een kleiner bestand dat wel representatief is.
Ookal is 10,000 de gegeven standaard voor Seqtk wij hebben gekozen voor 1,000,000 een reden hiervoor is dat een grotere kans heeft om representatief te zijn voor de hele pipeline.
Een voorbeeld hiervan is Fastqc het standaard programma voor kwaliteitscontrole. Een van de proccesen hiervan kijkt voor sequenties die over-gerepresenteerd zijn maar dat is alleen voor sequenties die in de eerste 100,000 sequenties van het bestand voorkomen. en dus door een groter bestand te genereren kan dit procces beter getest worden voordat de echte dataset dit analyseerd. (https://www.bioinformatics.babraham.ac.uk/projects/fastqc/Help/3%20Analysis%20Modules/8%20Duplicate%20Sequences.html)


```{r eval=FALSE}

cd /run/media/floris/FLORIS_3/DATA_SETS/3D_Chromatine_Conformatie/DNA/SRA

seqkit head -n 1000000 SRR26980527_1.fastq > subset_SRR26980527_1.fastq
seqkit head -n 1000000 SRR26980527_2.fastq > subset_SRR26980527_2.fastq
```

### fastqc en trimmomatic 
ik en storm hebben wij de taken fastqc en trimmomatic pipeline gekregen omdat wij vorig jaar in een eerder project hiermee hebben gewerkt. Fastqc[1] gebruiken wij om de kwaliteit van de sequentie's te analyseren en Trimmomatic[2] gebruiken wij om de sequenties de van te lage kwaliteit zijn te verwijderen.

### Resultaten
Taakverdeling gemaakt
Begin gemaakt aan het Fastqc commando
Geholpen met test dataset in map fastq/test_data

## Dinsdag
fastqc en multiqc vandaag verder uitgewerkt en het commando uitgevoerd zodat wij kunnen kijken wat de kwaliteit van de samples is. Hiervoor hebben wij de R library fastqcr gebruikt, omdat dit de R versie is van fastqc. Nadat dit programma klaar was hebben we multiqc gerund voor een overzicht van al onze data 

### Uitleg FastQC
FastQC is een kwaliteits controle programma voor sequentie data gegeneerd uit next generation sequencing apparaten. dit programma kan je een indruk geven van de kwaliteit van jouw data en waar eventuele problemen liggen. 
Het doet dit doormiddel van het analyseren van de fastq file die gegenereerd word door de sequincer. dit bestand bestaad uit een header begginnent met @ gevolgd door een identifier en een optionele input, in de volgende rij komt de sequentie letters. De derde rij begint met een + bevat optioneel de identifier, en de vierde rij bevat een kwaliteit score per base in ASCII caracters aan de hand van hoe zeker de sequencer is per base.
1 van deze plots die fastqc weergeeft is de "per base sequence quality" dit plot geeft de algemene kwaliteit per nucleotide base weer aan de hand van hoe zeker het sequencer apparaat dit heeft meegegeven in de fastq file.
Aan de hand hiervan kun je de gemiddelde kwaliteit van jouw sample bestuderen en beslissen of jouw data betrouwbaar is of niet.


#### Uitleg MultiQC
Het doel van MultiQC[5] is om in 1 bestand een overzicht te krijgen als je meerdere bestanden hebt waarvan je de kwaliteit wil weten, Dit programma maakt hiervoor een overzicht

### Uitleg Trimmomatic
Trimmomatic is een data procesing programma voor fastq files. Wat trimmomatic doet is aan de hand van de meegegeven opties verwijderd sequentie data dat van eventuele slechte kwaliteit is. voorbeelden van de opties die je mee kunt geven aan dit programme zijn:
Sliding window(base lengte : kwaliteit score) deze optie scant een opgegeven hoeveelheid basen en verwijderd deze als ze onder de opgegeven kwaliteit komen.
Iluminaclip verwijderd adapters en andere ilumina specifieke sequenties van de read.

### FastQC en MultiQC run 
Hieronder het automation script voor fastqc run in de fastq map

```{r eval=FALSE}
# Set working directory naar de map met fastq bestanden
setwd("/students/2024-2025/Thema05/3dconformatieChromatine/fastq")
(x = getwd())
# Fastqc run commando
# fq.dir is de input map, qc.dir is de output map
# fastqc.path is het pad naar het fastqc programma[1]
fastqc(fq.dir = x, qc.dir = "/students/2024-2025/Thema05/3dconformatieChromatine/fastqc_output/", fastqc.path = "/usr/bin/fastqc", threads = 100)
```

MultiQC command

```{bash, eval=FALSE}
# Verander current working directory naar de fastqc output map
pwd
cd ../
cd fastqc_output
pwd
# De "." zorgt neemt alle fastqc mappen in de curren working directory als input 
multiqc .
# Output word in de current working directory gegenereerd
```

### multiqc resultaten

![General statatistics multicq](../Logboek_recources/fastqc/multiqc_ruw_gen_stats.png)
Uit de general statistics plot kan ik halen dat de download van de eerste sample mislukt is. Ook bevatten de eerste 4 samples en hun reverse componenten ruim 90% duplicaten wat dramatisch slecht is.

![seq quality](../Logboek_recources/fastqc/multiqc_ruw_seq_quality.png)
De kwaliteit per base plot laat zien dat de samples met de 90% duplicates ook van best slechte kwaliteit zijn. ook is het biezonder dat de gehighlighte sample een sprong in kwaliteit maakt. de normale verwachting is dat de lijn in de kwaliteit een soort banaan vorm heeft. de samples die minder dan 90% duplicates hebben lijken van voldoende kwaliteit.

![adapter](../Logboek_recources/fastqc/multiqc_ruw_adapter_content.png)
De 90% duplicatie samples hebben ook dramatisch hoge adaptercontent score. dit zou mogelijk een verklaring kunnen zijn van de hoeveelheid duplicaties. 

![duplies](../Logboek_recources/fastqc/multiqc_ruw_dupli_lvl.png)
Dit plot visualiseert de hoeveelheid duplicatie per sequentie. van de eerste 4 samples had ik verwacht dat de piek in duplicaten hoger zou zijn aan het begin vanwege de hoeveelheid adapters. dit zou kunnen hinten naar pcr artefacten.

![overrepresentive](../Logboek_recources/fastqc/multiqc_ruw_overrep_seq.png)


Hieruit kun je zien dat de sample's 527,528,529,530 van zeer slechte kwaliteit zijn. Het meest bijzondere aan deze samples is de absurde hoeveelheid duplicaten hierin.
Bij de individuele fastqc rapporten van de bovenstaande 4 samples heb ik gekeken naar de overrepresented sequences.
In deze lijst stonden een paar sequenties die herkent werden als adapters maar de meesten niet. Ik heb 1 van de sequentie op advies van Ronald geblast.
BLAST is een alignment tool van NCBI en het doel van dit programma is het vergelijkingen van de opgegeven sequentie met de referentie database om te kijken wat opgegeven sequentie is en waarvoor hij misschien zou kunnen zijn. 

Ik heb 1 van de sequentie's die voor 60% verantwoordelijk was voor de duplicatie door 4 blast databasen gehaald en hieruit kwam bij alle 4 geen match.

### Uitkomst Eerste FastQC
Dit alles bij elkaar vindt ik dat we de eerste 4 samples waarschijnlijk niet bruikbaar zijn voor verder onderzoek vanwege hun slechte kwaliteit. de laatste 4 lijken wel van goed genoege kwaliteit te zijn om te gebruiken.
Deze samples scoren goed in de algemene kwaliteit plotten na het trimmen moet er nog wel gekeken worden naar de duplicatie plots om te kijken of daar nog eventuele problemen in kunnen zitten

#### Blast settings
Core nucleotide database
Nucleotide collections 
refseq genome databse (Mus Muscus)
refseq Reference genomes (Mus Muscus)

### Resultaten
FastQC + Multiqc analyse gedaan, bestanden staan in /students/2024-2025/Thema05/3dconformatieChromatine/fastqc_output/

## Woensdag
Het doel van vandaag is samen met storm en Jarno aan het automatische bwa-mem commando werken. 

### mapping bijproduct
Om uit te vinden van wat de 4 eerste samples zijn hadden wij het idee om het sample te mappen tegen een referentie genoom om te kijken wat deze samples zouden kunnen zijn. uiteindelijk hebben wij hier niks mee gedaan vanwege de slechte kwaliteit van deze samples. Dit wordt later in het logboek uitgelegd.
Gezamenlijk zijn wij bezig geweest met het BWA-MEM commando en hebben dit ook gerunt. maar vervolgens hebben wij hier niks me gedaan. de uitleg hiervoor komt later in het bestand.


## Vrijdag
Vandaag is het doel om samen met storm het trimmomatic commando af te maken zodat we daar mee kunnen experimenteren voor onze data analyse.

### Trimmomatic settings
minlen 40 
standaard, verwijdert alle reads weg met een lengte van onder de 40

slidingwindow 4 : 20 
standaard verwijdert alle sequenties als de gemmiddelde kwaliteit per 4 sequenties onder de 20 komt.

Ilumina clip: /pad/TruSeq3 
Voor het verwijderen van adapters hiervoor hebben we de door trimmomatic meegeven TruSeq3 adapters gebruikt omdat de dit standaard adapters zijn door HiSeq en MiSeq sequencer aparaten. In ons geval is de nieuwe NovaSeq 6000 gebruikt. Zoals het lijkt zijn de standaard adapters hiervoor niet veranderd.
(https://www.researchgate.net/post/Have_Illumina_adapter_sequences_changed_for_NovaSeq_6000)

threads -80 hoeveelheid instructies die gestuurd kunnen worden naar de CPU's.

Trimmomatic command
het orginele commando bestaad uit:
TrimmomaticPE voor paired end, threads, input bestand forward, input bestand reverse, paired output_1 , unpaired output_1, paired output_2, unpaired output_2, opties         
```{bash eval=FALSE}
# parralel runnen op de SraAcc list zodat er maar 1 run is per sample en deze gepaard blijven
# doormiddel van {}_1 en {}_2
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | \
  parallel 'TrimmomaticPE -threads 80 ' \
                  '/students/2024-2025/Thema05/3dconformatieChromatine/fastq/{}_1.fastq ' \
                  '/students/2024-2025/Thema05/3dconformatieChromatine/fastq/{}_2.fastq ' \
                  '/students/2024-2025/Thema05/3dconformatieChromatine/Trimmomatic_output/paired/{}_forward_paired.fastq ' \
                  '/students/2024-2025/Thema05/3dconformatieChromatine/Trimmomatic_output/unpaired/{}_forward_unpaired.fastq ' \
                  '/students/2024-2025/Thema05/3dconformatieChromatine/Trimmomatic_output/paired/{}_rev_paired.fastq ' \
                  '/students/2024-2025/Thema05/3dconformatieChromatine/Trimmomatic_output/unpaired/{}_rev_unpaired.fastq ' \
                  'ILLUMINACLIP:/students/2024-2025/Thema05/3dconformatieChromatine/Trimmomatic/Trimmomatic-0.39/adapters/TruSeq3-SE.fa:2:30:10 ' \
                  'MINLEN:40 ' \
                  'SLIDINGWINDOW:4:20'
                  'HEADCROP:10'
```

### Resultaten
Functioneel bash script voor trimmen

# Week 3 Eindresultaat quality control en bwa mapping en varriant calling

## Maandag
Het doel vandaag is besluiten wat we doen met de samples van dramatisch slechte kwaliteit en met trimmomatic experimenteren. Dit doen we om de data klaar te zetten voor het mappen en alignen.

### Besluit samples
Als groep hebben we besloten om de samples 527,528,529,530 te verwijderen uit verdere pipeline vanwege slechte kwaliteit score op het fastqc rapport en we hebben het sample type wildtipe niet per se nodig voor ons genetisch onderzoek.

### Trimmomatic en FastQC
Trimmomatic 2 pogingen met en zonder de optie headcrop + fastqc en multiqc voor controle van de getrimde data.
verdere opties:
minlen 40
zo als beschreven in het vorige trimmomatic commando

slidingwindow 4:20
zo als beschreven in het vorige trimmomatic commando

Iluminaclip Truseq3
zo als beschreven in het vorige trimmomatic commando

Headcrop: 10
Het idee hierachter was de eerste 10 bases te verwijderen in het geval er nog veel over-gerepresenteerde sequences waren en bij de samples die later vandaag verwijderd zijn. aangezien een aantal van deze sequences op adapters leken en of in elk geval heel erg op elkaar leken dachten we dat het verwijderen van de eerste 10 bases met een potentieële adapter en identificator sequentie te verwijderen om de samples mogenlijk bruikbaar te maken.

circa 95% van de reads per sample overleven het als gepaarde read.
In de trimmomatic output stond dat het headcrop argument was gefaald en niet is meegenomen in het trimmen. Dit beinvloed ons verder niet omdat we de samples waarvoor we de headcrop wouden gebruiken verwijderd zijn.

![general stats trimd](../Logboek_recources/fastqc/multiqc_trimd_gen_stats.png)
Bij de standaard statistieken zie ik dat de CG percentages iets uit elkaar liggen mijn eerste gedachte hierbij was dat de samples misschien gecontamineerd is maar volgens Ronald is het normaal dat CG% 1% of 2% uit elkaar kunnen liggen aan de hand van het type cell dus dit hoeft geen probleem te zijn. 
Het gemmiddelde CG percentage van een muis is 42% (GRCm39 reffrence genome. https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_000001635.27/). Het chromosome met het hoogste CG% is 44% op chromosome 11. 
Dit is ook het chromosome waar het Ebf1 gen op ligt dat gebruikt is in het onderzoek. (https://www.ncbi.nlm.nih.gov/gene/13591)
Onze samples hebben een gemiddelde CG percentage van 45,75 deze informatie bevestigt ons idee dat dit onderzoek geen whole genome sequencing heeft gedaan maar een selectie heeft gemaakt en dit waarschijnlijk heeft geampliceerd met de aaname dat dit choromosme 11 is met de reden dat hier het Ebf1 gen op ligt dat critiek is bij dit onderzoek.
De hoeveelheid duplicaties kan hiermee deels verklaart worden.

![general stats](../Logboek_recources/fastqc/multiqc_trimd_seq_quality.png)
Zoals hier te zien is de gemiddelde kwaliteit van deze samples wel goed het piek omhoog aan het eind is resultaat van het trimmen.

![general stats](../Logboek_recources/fastqc/multiqc_trimd_leng_distri.png)
Het opvallende hier is dat er een piek aan het begin bij circa 10 readlengt. dit hoort niet te kunnen aangezien hij alle reads onder 40 in lengte door trimmomatic had moeten verwijderen. Trimmomatic had ook geen error aangegeven dat het minlen argument was gefaald of niet gevonden was.

![general stats](../Logboek_recources/fastqc/multiqc_trimd_cg_content.png)
Het CG plot geeft een waarschuwing aan omdat het cg percentage een beetje afwijkt van een normaal verdeling heeft.
Aangezien er geen scherpe pieken zijn in deze grafiek betekent het dat de samples in elk geval niet gecontamineerd zijn. 
Voor het trimmen gaven deze samples ook al een waarschuwing van fastqc vanwege de afwijking in deviatie. Zoals ik bij de de standaard statistiek plot heb uitgezocht ben ik van mening dat ook al is de grafiek niet netjes denk ik dat het niet een significant probleem is voor ons verdere onderzoek.
De 2 verschillende hoogtes zal waarschijnlijk te maken hebben met het feit dat zoals te zien bij standaard statistieken dat er verschillende hoeveelheden sequentie gemeten zijn en dat er tussen 549/550 100 miljoen sequentie's gemeten zijn en bij 551/552 150 miljoen sequenties zijn gemeten.

Overrepresented sequences
Hier is geen plot voor maar het gaf een waarschuwing aan bij de 4 reverse paired reads. hier zal ik morgen naar kijken en eventueel met ronald overleggen omdat ik het raar vind dat dit alleen voorkomt bij de reverse paired reads.

Adapter content
hier is ook geen plot meer voor omdat er geen adapters meer gevonden zijn.  

## Dinsdag
Het doel van vandaag is overleggen met Ronald over onze onderzoeksvraag en commentaar op de fastqc data.

### Commentaar Fastqc
multiqc overrepresentive sequences. 
Na het bekijken van de individuele fastqc bestanden blijkt dat alle reverse read samples een overrepresentatie hebben van een verlengde GGGGGGG van varieërende lengtes. 
Volgens Ronald kan dit een echt stuk genoom zijn of pcr artifact.
Ik heb 1 van de sequences geblast via (https://blast.ncbi.nlm.nih.gov/Blast.cgi) door de volgende databases (Mus Muscus):
Core nucleotide database.
Nucleotide collections.
Bij beide databases was er geen match en een globale google search om te kijken of er een lange ggg repeat sequentie in het genoom van een muis zit leverde ook geen informatie op.
Dit samen met het feit dat dit deze sequentie alleen wordt aangegeven op de reverse pair reads concludeer ik dat dit hoogstwaarschijnlijk een mechanische fout heeft plaats gevonden tijdens het sequencen.

### Conclussie FastQC
De conclusie van de fastqc rapport is dat de samples 549, 550, 551, 551 goed zijn op het gebied van de algemene sequentie kwaliteit. Alleen deze samples laten een aantal bijzonderheden zien die we niet helemaal kunnen verklaren, maar hoogstwaarschijnlijk niet ernstig genoeg zijn om de verdere stappen te kunnen beïnvloeden.

### Onderzoeksvraag
Als groep hadden wij tot vandaag nog geen onderzoeksvraag. Na overleg met Ronald zijn wij op het volgende gekomen. 
"Zijn er genetische varianten te vinden in het embf1 en pax5 gen te vinden dat het vorige onderzoek kan beinvloeden" die in het genoom van rag2(-/-) muizen

### BWA mapping
Voor een voledige uitleg van bwa-mem2 mappen zie het logboek van Jarno en Floris. 
Voor het Mappen gebruiken wij BWA-mem2[6]. 
We hebben voor deze tool gekozen omdat het volgens de mensen achter bwa de volgende versie is en een stuk efficiënter dan de standaard bwa mapper. 
Ook word bij het BIN galaxy systeem van de Hanze Bio-informatica systeem aangeraden om bij het mappen van reads langer dan 100 basisparen bwa-mem2 te gebruiken. Dit is toepasbaar op onze data omdat wij een gemmidelde readlengte van circa 150 hebben, zie read lengt distributie plot van de fastqc analyse.

#### Mapping en Aligment uitleg
Mappen is het proces van alle reads tegen een referentie genoom aan te leggen zodat je weet welke read op welke plek in het genoom hoort. Dit word gedaan zodat je alle reads op de plekken liggen waar ze horen en je hierna een analyse op kunt doen om te kijken of er varianten in de genen liggen. meer hierover bij variant calling.
De overlappende reads op 1 plek in het genoom wordt ook wel de covarage van een gen of positie genoemd.


#### Code van Floris
```{bash eval=FALSE}
# Voor een enkel sample:
samtools sort -@40 -n -O BAM -o aligned_sorted_SRR26980549.bam aligned_SRR26980549.sam

# Met parallel:
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel 'samtools sort -@40 -n -O BAM -o samtools_output/aligned_sorted_{}.bam BWA_aligned_output/aligned_{}.sam ' &
```

```{bash eval=FALSE}
# Voor een enkel sample:
samtools fixmate -m --threads 40 aligned_sorted_SRR26980549.bam \ fixed_mates_aligned_sorted_SRR26980549.bam

# Met parallel:
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel 'samtools fixmate -m --threads 40 samtools_output/aligned_sorted_{}.bam samtools_output/fixed_mates_aligned_sorted_{}.bam' &
```

```{bash eval=FALSE}
# Voor een enkel sample:
samtools sort -@80 -o sorted_coordinates_SRR26980549.bam \ fixed_mates_aligned_sorted_SRR26980549.bam

# Met parallel:
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel 'samtools sort -@80 -o samtools_output/sorted_coordinates_{}.bam samtools_output/fixed_mates_aligned_sorted_{}.bam' &
```

```{bash eval=FALSE}
# Voor een enkel sample:
samtools markdup -r -s sorted_coordinates_SRR26980549.bam dedup_SRR26980549.bam

# Met parallel:
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel  'samtools markdup -@80 -r -s samtools_output/sorted_coordinates_{}.bam samtools_output/dedup_{}.bam' &
```

```{bash eval=FALSE}
# Voor een enkel sample:
samtools index -@80 dedup_SRR26980549.bam dedup_SRR26980549.bai  &

# Met parallel:
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel 'samtools index -@80 samtools_output/dedup_{}.bam samtools_output/dedup_{}.bai' &
```


### Freebayes variant calling * nog uitbreiden
Voor een voledige uitleg van Freebayes[7] variant calling zie het logboek van Jarno en Floris.

#### Variant calling uitleg
Variant calling is het proces van het vinden van varianten op een positie in het genoom op basis van de hoeveelheid reads en de referentie positie.

De exacte parameters van Freebayes staat niet in hun handleiding maar uit de lessen van Bio-informatica thema5(https://rwedema.github.io/NGS-Genetics/mapping.html) kan ik er van uit gaan dat een variant minstens een covarige van 20 reads nodig heeft om geclassificeerd te worden als variant. Onder 20 reads is het namelijk lastig om het statistisch te verantwoorden dat het een varriant is of een technische fout. 

#### Variant anotatie uitleg *nog uitbreiden
annotatie is metadata t
#### SNPeff *nog uitbreiden

#### Floris zijn code
```{bash eval=FALSE}
# Voor een bestand:
/students/2024-2025/Thema05/3dconformatieChromatine/freebayes/freebayes-1.3.6-linux-amd64-static \
 -f /students/2024-2025/Thema05/3dconformatieChromatine/Mapping_ref/ncbi_dataset/ncbi_dataset/data/GCA_000001635.9/GCA_000001635.9_GRCm39_genomic.fna dedup_SRR26980549.bam | /students/2024-2025/Thema05/3dconformatieChromatine/vcffilter/vcffilter-assembly-0.2.jar -f "QUAL > 30" > filtered_SRR26980549.vcf
 
 
# Met parallel: 
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel '/students/2024-2025/Thema05/3dconformatieChromatine/freebayes/freebayes-1.3.6-linux-amd64-static \
 -f /students/2024-2025/Thema05/3dconformatieChromatine/Mapping_ref/ncbi_dataset/ncbi_dataset/data/GCA_000001635.9/GCA_000001635.9_GRCm39_genomic.fna samtools_output/dedup_{}.bam | /students/2024-2025/Thema05/3dconformatieChromatine/vcffilter/vcffilter-assembly-0.2.jar -f "QUAL > 30" > variant_calling/filtered_{}.vcf' &
 
 # Variant calling zonder direct te filteren:
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel '/students/2024-2025/Thema05/3dconformatieChromatine/freebayes/freebayes-1.3.6-linux-amd64-static \
 -f /students/2024-2025/Thema05/3dconformatieChromatine/Mapping_ref/ncbi_dataset/ncbi_dataset/data/GCA_000001635.9/GCA_000001635.9_GRCm39_genomic.fna samtools_output/dedup_{}.bam > variant_calling/variants{}.vcf' &
```

```{bash eval=FALSE}
# Voor een bestand:
/students/2024-2025/Thema05/3dconformatieChromatine/freebayes/freebayes-1.3.6-linux-amd64-static \
 -f /students/2024-2025/Thema05/3dconformatieChromatine/Mapping_ref/ncbi_dataset/ncbi_dataset/data/GCA_000001635.9/GCA_000001635.9_GRCm39_genomic.fna dedup_SRR26980549.bam | /students/2024-2025/Thema05/3dconformatieChromatine/vcffilter/vcffilter-assembly-0.2.jar -f "QUAL > 30" > filtered_SRR26980549.vcf
 
 
# Met parallel: 
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel '/students/2024-2025/Thema05/3dconformatieChromatine/freebayes/freebayes-1.3.6-linux-amd64-static \
 -f /students/2024-2025/Thema05/3dconformatieChromatine/Mapping_ref/ncbi_dataset/ncbi_dataset/data/GCA_000001635.9/GCA_000001635.9_GRCm39_genomic.fna samtools_output/dedup_{}.bam | /students/2024-2025/Thema05/3dconformatieChromatine/vcffilter/vcffilter-assembly-0.2.jar -f "QUAL > 30" > variant_calling/filtered_{}.vcf' &
 
 # Variant calling zonder direct te filteren:
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel '/students/2024-2025/Thema05/3dconformatieChromatine/freebayes/freebayes-1.3.6-linux-amd64-static \
 -f /students/2024-2025/Thema05/3dconformatieChromatine/Mapping_ref/ncbi_dataset/ncbi_dataset/data/GCA_000001635.9/GCA_000001635.9_GRCm39_genomic.fna samtools_output/dedup_{}.bam > variant_calling/variants{}.vcf' &
```

```{bash eval=FALSE}
samtools faidx GCA_000001635.9_GRCm39_genomic.fna
```

```{bash eval=FALSE}
# Test voor een enkel .bam bestand: 
/students/2024-2025/Thema05/3dconformatieChromatine/freebayes/freebayes-1.3.6-linux-amd64-static -f GCA_000001635.9_GRCm39_genomic.fna \ /students/2024-2025/Thema05/3dconformatieChromatine/aligned_sorted_SRR26980549.bam > \ /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/SRR26980549_test.vcf
```
```{bash eval=FALSE}
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel 'java -jar /students/2024-2025/Thema05/3dconformatieChromatine/vcffilter/vcffilter-assembly-0.2.jar -I variant_calling/variants{}.vcf --minQualScore 30 --outputVcf variant_calling/filterd_variant_{}.vcf'
```

```{bash eval=FALSE}
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel 'bamToBed -i dedup_{}.bam > dedeup_{}.bed'
```

```{bash eval=FALSE}
# Test:
/students/2024-2025/Thema05/3dconformatieChromatine/snpEff/snpEff.jar mm39 filtered_variants.vcf > annotated_variants.vcf

# Voor alle .vcf bestanden:
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel 'java -jar \ /students/2024-2025/Thema05/3dconformatieChromatine/snpEff/snpEff.jar mm39 /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/filterd_variant_{}.vcf > /students/2024-2025/Thema05/3dconformatieChromatine/annotated_variants_{}.vcf'

# Alleen het isec .vcf bestand:
java -jar /students/2024-2025/Thema05/3dconformatieChromatine/snpEff/snpEff/snpEff.jar mm39 /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/isec.vcf > /students/2024-2025/Thema05/3dconformatieChromatine/annotated_isec.vcf
```

```{bash eval=FALSE}
# Navigeer naar de directory waar de databases opgeslagen worden. 
cd snpEff/snpEff/data/

# Download het .gff bestand:
wget https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/001/635/GCF_000001635.27_GRCm39/GCF_000001635.27_GRCm39_genomic.gff.gz
```

```{bash eval=FALSE}
# Downloaden van benodigde bestanden: 

# Referentiegenoom (Refseq)
wget https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/001/635/GCF_000001635.27_GRCm39/GCF_000001635.27_GRCm39_genomic.fna.gz

# Annotatiebestand: (.GTF)
wget https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/001/635/GCF_000001635.27_GRCm39/GCF_000001635.27_GRCm39_genomic.gtf.gz

# protein.faa:
wget https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/001/635/GCF_000001635.27_GRCm39/GCF_000001635.27_GRCm39_protein.faa.gz

# Plaats bestanden in SnpEff/snpEff/data/mm39/

# Hernoem bestand GCF_000001635.27_GRCm39_genomic.fna.gz --> sequences.fa

# Hernoem bestand GCF_000001635.27_GRCm39_protein.faa.gz --> protein.fa
```

```{bash eval=FALSE}
java -jar /students/2024-2025/Thema05/3dconformatieChromatine/snpEff/snpEff/snpEff.jar build -gtf22 -nodownload -v  mm39
```

```{bash eval=FALSE}
bgzip -c /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/isec.vcf > /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/isec.vcf.gz
```

```{bash eval=FALSE}
tabix -p vcf /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/isec.vcf.gz
```

```{bash eval=FALSE}
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel \
'bcftools annotate --rename-chrs /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/names.txt /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/filterd_variant_{}.vcf.gz > /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/hernoemd_{}.vcf'
```

```{bash eval=FALSE}
java -jar /students/2024-2025/Thema05/3dconformatieChromatine/snpEff/snpEff/snpEff.jar -v -stats /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/SRR26980549_annotatie.html mm39 /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/hernoemd_SRR26980549.vcf > /students/2024-2025/Thema05/3dconformatieChromatine/annotated_SRR26980549.vcf
```

```{bash eval=FALSE}
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel \
'java -Xmx80G -jar /students/2024-2025/Thema05/3dconformatieChromatine/snpEff/snpEff/snpEff.jar -v -stats /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/{}_annotatie.html mm39 /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/hernoemd_{}.vcf -threads 50 > /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/annotated_{}.vcf'
```

```{bash eval=FALSE}
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel 'bgzip annotated_{}.vcf'
```

```{bash eval=FALSE}
cat /students/2024-2025/Thema05/3dconformatieChromatine/SRA/SraAccList.csv | parallel 'tabix -p vcf annotated_{}.vcf.gz'
```

```{bash eval=FALSE}
bcftools isec -c all annotated_SRR26980549.vcf annotated_SRR26980550.vcf annotated_SRR26980551.vcf annotated_SRR26980552.vcf > isec.vcf
```

```{bash eval=FALSE}
java -jar /students/2024-2025/Thema05/3dconformatieChromatine/snpEff/snpEff/snpEff.jar -v -stats /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/isec_annotatie.html mm39 /students/2024-2025/Thema05/3dconformatieChromatine/variant_calling/isec.vcf > /students/2024-2025/Thema05/3dconformatieChromatine/annotated_isec.vcf
```



## woensdag
logboek review ronald

## Vrijdag
werken aan logboek

# Week 4

## Maandag 
werken aan logboek

# Week 5

## maandag
werken aan logboek

## Dinsdag 
Het doel van vandaag is het voorbereiden van de visualisatie.

### lijst van mogenlijke visualisatie met bron
genomics 1.1 les

allel frequentie barplot
varianten per gene
varianten van interesse vinden met snipshift

tjerk les
volcanono plot
https://en.wikipedia.org/wiki/Volcano_plot_(statistics)

manhatten plot
voor genome whole studie 
https://en.wikipedia.org/wiki/Manhattan_plot#:~:text=A%20Manhattan%20plot%20is%20a,GWAS)%20to%20display%20significant%20SNPs.

### woensdag
#### notitie extra visualisatie 
principale compinenten theorie
tsna umap niet relevant

#### taakverdeling voor de week
presntatie transcriptie presentatie floris
veranderen van chromosomen van annotatie vcf bestand jarno
isec vcf varianten op de bed file filteren. storm
pca op de hele anotatie [granges] ivar
isac, annotated variant + bed galaxy visualistaie backlog
trackviewer bioconducter vcf + bam of bed backlog
manhatten plot, volcano , lollipop plot jarno 

## Donderdag
Vandaag heb ik een begin gemaakt pricipale componenten analyse. Dit doe ik omdat ik wil zien hoe de variantie tussen de samples is op het gebied van het nog uit te selecterende meta data.
Dit heb ik gedaan door de geanoteerde bestanden in te lezen en daarna Granges objecten van te maken om zo aan elke variant meta data mee te geven.

### Principale componenten analyse

Isec bestand inladen *nog niet gebruikt 
```{r}
# read isac
#an_isec <- read.delim("/Users/ivarl/Desktop/annotated_isec.vcf", skip = 5,header = FALSE, #stringsAsFactors = FALSE)
```

Sample's bestanden inladen
```{r}
# inladen data skip 129 lines aan metadata 
ssr_549_an <- read.delim("/Users/ivarl/Desktop/annotated_SRR26980549.vcf", skip=129 ,stringsAsFactors = FALSE)
ssr_550_an <- read.delim("/Users/ivarl/Desktop/annotated_SRR26980550.vcf", skip = 129, stringsAsFactors = FALSE)
ssr_551_an <- read.delim("/Users/ivarl/Desktop/annotated_SRR26980551.vcf", skip = 129, stringsAsFactors = FALSE)
ssr_552_an <- read.delim("/Users/ivarl/Desktop/annotated_SRR26980552.vcf", skip = 129, stringsAsFactors = FALSE)

```

```{r}
# check tabel
head(ssr_549_an)
```

```{r}
# irange object
irange_object_ssr_549 <- IRanges(start = ssr_549_an$POS,
                         end = ssr_549_an$POS,
                        names = ssr_549_an$X.CHROM
                         )
# grange object
grange_object_ssr_549 <- GRanges(seqnames = ssr_549_an$X.CHROM,
                          ranges = irange_object_ssr_549)
grange_object_ssr_549
```

```{r}
# info lijst splitten
info_list_ssr_549 <- strsplit(ssr_549_an$INFO,split = ";")
# matrix maken
info_matrix_ssr_549 <- do.call(rbind, info_list_ssr_549)
#info_matrix_ssr_549
```

```{r}
# meta data selectie
# allel freqwentie
info_matrix_ssr_549 <- gsub("AF=", replacement = "", x = info_matrix_ssr_549)
#info_matrix_ssr_549[,4]

# numeric maken voor latere analyse
allel_freq_ssr_549 <- as.numeric(info_matrix_ssr_549[,4])
# correctie NA gegeneerd door "0.5 0.5" in vector
allel_freq_ssr_549 <- replace_na(allel_freq_ssr_549, 0.5)
head(allel_freq_ssr_549)

# read depth
info_matrix_ssr_549 <- gsub("DP=", replacement = "", x = info_matrix_ssr_549)
read_dept_ssr_549 <- as.numeric(info_matrix_ssr_549[,8])
#read_dept_ssr_549
# lijst om toe te voegen
# moet Allel lengte 
# maybe Mean number of unique non-reference allele observations
```
Wat hier opvalt is dat de alle allel frequenties 0.5 of 1.0 zijn. In de praktijk zou dit niet mogelijk zijn dat alles zo'n strakke uitkomst heeft, vermoedelijk komt dit door een setting in freebayes.

## Vrijdag
Het doel van vandaag was verder werken aan de pca analyse. maar naar overleg met marcel is besloten dat een pca mischien iets te ambitieus is en voorlopig gedowngrade word naar een Venn diagram

### Venn diagram

```{r }
new_col_549 <- paste(as.character(ssr_549_an$POS), ssr_549_an$ALT, sep = "-")
new_col_550 <- paste(as.character(ssr_550_an$POS), ssr_550_an$ALT, sep = "-")
new_col_551 <- paste(as.character(ssr_551_an$POS), ssr_551_an$ALT, sep = "-")
new_col_552 <- paste(as.character(ssr_552_an$POS), ssr_552_an$ALT, sep = "-")

ggVennDiagram(list(new_col_549,new_col_550,new_col_551,new_col_552),
              category.names = c("SRA 549", "SRA 550", "SRA 551", "SRA 552"),
              set_size = 3.5) + 
  ggplot2::scale_fill_gradient(high = "#085078", low = "#24C6DC")+ 
  labs(title = "Overlappende mutatie's per SRA sample",
       caption = "Overlappende mutatie's per sra sample op basis van de positie en alternatieve nucleotide.\n Gemaakt met de geanoteerde vcf bestanden van deze samples.")+
  theme(plot.caption = element_text(hjust = 0))
```

Hierboven zie je de ven diagram van de overlappende mutaties per sample op basis van alternatieve nucleotide. Wat hier opvalt is dat de totale hoeveelheid gedeelde mutatie's maar 8% geteeld is over alle mutatie's heen, en dat alle samples op zich zelf toch wel een een significante hoeveelheid mutatie's hebben.

# Week 6

## maandag
Het doel van vandaag is verder werken aan de ven diagram


# bibliografie 
[1]Fastqc
Versie 0.12
https://www.bioinformatics.babraham.ac.uk/projects/fastqc/

[2]Trimmomatic
Versie 0.39
http://www.usadellab.org/cms/?page=trimmomatic 

[3]SRA Toolkit
Versie 3.1.1 
https://github.com/ncbi/sra-tools/wiki/08.-prefetch-and-fasterq-dump

[4]Seqtk
Versie ?
https://github.com/lh3/seqtk

[5]MultiQC
Versie ?
https://multiqc.info/

[6]BWA-mem2
Versie ?
https://github.com/bwa-mem2/bwa-mem2

[7]Freebayes
versie ?
https://github.com/freebayes/freebayes
